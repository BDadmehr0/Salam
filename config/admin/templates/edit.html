<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit {{ filename }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1>Edit File: {{ filename }}</h1>

		{% if message %}
			<div class="alert {% if message_type == 'ok' %}alert-success{% else %}alert-danger{% endif %}" role="alert">
				{{ message }}
			</div>
		{% endif %}
		
		<table class="table table-bordered" id="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Text (EN)</th>
                    <th>Text (FA)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td><input class="form-control" value="{{ item.id }}" /></td>
                    <td><input class="form-control" value="{{ item.text.en if item.text else '' }}" /></td>
                    <td><input class="form-control" value="{{ item.text.fa if item.text else '' }}" /></td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteRow(this)">Delete</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button class="btn btn-success" onclick="addRow()">Add Row</button>
        <button class="btn btn-primary" onclick="save()">Save Changes</button>
    </div>

    <script>
        function addRow() {
            const table = document.getElementById('data-table').querySelector('tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input class="form-control" value="" /></td>
                <td><input class="form-control" value="" /></td>
                <td><input class="form-control" value="" /></td>
                <td><button class="btn btn-danger btn-sm" onclick="deleteRow(this)">Delete</button></td>
            `;
            table.appendChild(row);
        }

        function deleteRow(button) {
            button.closest('tr').remove();
        }

        function save() {
            const rows = document.getElementById('data-table').querySelectorAll('tbody tr');
            const items = Array.from(rows).map(row => {
                const cells = row.querySelectorAll('input');
                return {
                    id: cells[0].value,
                    text: {
                        en: cells[1].value,
                        fa: cells[2].value
                    }
                };
            });
            axios.post(window.location.pathname, { items })
                .then(response => alert('Saved successfully!'))
                .catch(error => alert('Failed to save.'));
        }
    </script>
</body>
</html>
